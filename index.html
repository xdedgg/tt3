<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊúçÂä°ËÆ∞ÂΩïÊü•ËØ¢ÁÆ°ÁêÜÁ≥ªÁªü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #1a73e8 0%, #6c8ef5 100%);
            color: white;
            padding: 25px 30px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .main-content {
            display: flex;
            min-height: 600px;
        }
        
        .sidebar {
            width: 320px;
            background-color: #f9fafc;
            border-right: 1px solid #eaeaea;
            padding: 25px;
        }
        
        .content {
            flex: 1;
            padding: 25px;
        }
        
        .section-title {
            font-size: 20px;
            color: #1a73e8;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 15px;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: #1a73e8;
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .input-with-button {
            display: flex;
            gap: 5px;
        }
        
        .input-with-button .form-control {
            flex: 1;
        }
        
        .btn-input {
            background-color: #1a73e8;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0 15px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .btn-input:hover {
            background-color: #0d62d9;
        }
        
        .date-range {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .date-range span {
            color: #777;
            text-align: center;
            margin: 5px 0;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #1a73e8;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0d62d9;
        }
        
        .btn-secondary {
            background-color: #f1f3f4;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e3e6e8;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-photo {
            background-color: #34a853;
            color: white;
        }
        
        .btn-photo:hover {
            background-color: #2e8b47;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        .records-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .summary-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            flex: 1;
            min-width: 200px;
            border-left: 4px solid #1a73e8;
        }
        
        .summary-card.warning {
            border-left-color: #fbbc04;
        }
        
        .summary-card.danger {
            border-left-color: #ea4335;
        }
        
        .summary-card.location {
            border-left-color: #9c27b0;
        }
        
        .summary-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: 700;
            color: #1a73e8;
        }
        
        .summary-card.warning .summary-value {
            color: #fbbc04;
        }
        
        .summary-card.danger .summary-value {
            color: #ea4335;
        }
        
        .summary-card.location .summary-value {
            color: #9c27b0;
        }
        
        .records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .records-table th {
            background-color: #f1f3f4;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #ddd;
        }
        
        .records-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .records-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .records-table tr.abnormal {
            background-color: #fff8e1;
        }
        
        .records-table tr.abnormal:hover {
            background-color: #fff5d6;
        }
        
        .records-table tr.location-abnormal {
            background-color: #f3e5f5;
        }
        
        .records-table tr.location-abnormal:hover {
            background-color: #e8daef;
        }
        
        .records-table tr.both-abnormal {
            background-color: #ffebee;
        }
        
        .records-table tr.both-abnormal:hover {
            background-color: #ffcdd2;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .status-completed {
            background-color: #e6f4ea;
            color: #137333;
        }
        
        .status-in-progress {
            background-color: #fef7e0;
            color: #b06000;
        }
        
        .status-cancelled {
            background-color: #fce8e6;
            color: #c5221f;
        }
        
        .duration-cell {
            font-weight: 600;
        }
        
        .duration-short {
            color: #34a853;
        }
        
        .duration-normal {
            color: #1a73e8;
        }
        
        .duration-long {
            color: #ea4335;
        }
        
        .location-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .location-ok {
            background-color: #e6f4ea;
            color: #137333;
        }
        
        .location-error {
            background-color: #fce8e6;
            color: #c5221f;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 4px;
            transition: background-color 0.2s;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .btn-view {
            background-color: #1a73e8;
            color: white;
        }
        
        .btn-view:hover {
            background-color: #0d62d9;
        }
        
        /* ÂºÇÂ∏∏ÂéüÁÇπÊ†áËØÜÊ†∑Âºè */
        .abnormal-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .duration-abnormal-dot {
            background-color: #fbbc04; /* ÈªÑËâ≤ - Êó∂ÈïøÂºÇÂ∏∏ */
        }
        
        .location-abnormal-dot {
            background-color: #9c27b0; /* Á¥´Ëâ≤ - ÂÆö‰ΩçÂºÇÂ∏∏ */
        }
        
        .record-id-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .detail-modal, .fullscreen-photo-modal, .tree-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .fullscreen-photo-modal {
            background-color: rgba(0, 0, 0, 0.95);
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 1000px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .tree-modal .modal-content {
            max-width: 600px;
            max-height: 80vh;
        }
        
        .modal-header {
            background-color: #1a73e8;
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            font-size: 22px;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }
        
        .close-btn:hover {
            transform: scale(1.1);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        /* Ê†ëÂΩ¢ÁªìÊûÑÊ†∑Âºè */
        .tree-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 10px;
        }
        
        .tree-list {
            list-style: none;
            padding-left: 0;
        }
        
        .tree-list ul {
            list-style: none;
            padding-left: 20px;
        }
        
        .tree-item {
            padding: 8px 10px;
            margin: 2px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .tree-item:hover {
            background-color: #f0f7ff;
        }
        
        .tree-item.selected {
            background-color: #e3f2fd;
            font-weight: 600;
            color: #1a73e8;
        }
        
        .tree-item .toggle {
            display: inline-block;
            width: 20px;
            text-align: center;
            margin-right: 5px;
            font-weight: bold;
        }
        
        .tree-item .icon {
            display: inline-block;
            width: 20px;
            text-align: center;
            margin-right: 5px;
        }
        
        .tree-search {
            margin-bottom: 15px;
        }
        
        .tree-search input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .detail-section {
            margin-bottom: 25px;
        }
        
        .detail-section h3 {
            font-size: 18px;
            color: #1a73e8;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .detail-item {
            margin-bottom: 10px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 16px;
        }
        
        .abnormal-tag {
            display: inline-block;
            background-color: #fce8e6;
            color: #c5221f;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .location-abnormal-tag {
            display: inline-block;
            background-color: #f3e5f5;
            color: #9c27b0;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        /* ËØ¶ÊÉÖ‰∏≠ÁöÑÁÖßÁâáÈ¢ÑËßàÈÉ®ÂàÜ */
        .photos-preview-section {
            margin-top: 10px;
        }
        
        .photos-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .photo-preview-item {
            width: 120px;
            height: 120px;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .photo-preview-item:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-count {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            padding: 4px;
            font-size: 12px;
        }
        
        /* ÂÖ®Â±èÁÖßÁâáÊü•ÁúãÊ†∑Âºè */
        .fullscreen-photo-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .fullscreen-photo {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .fullscreen-close-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            font-size: 30px;
            cursor: pointer;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 1001;
        }
        
        .fullscreen-close-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .photo-info-overlay {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 15px;
            backdrop-filter: blur(5px);
        }
        
        .location-map {
            height: 200px;
            background-color: #f0f0f0;
            border-radius: 8px;
            margin-top: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .location-map::before {
            content: "üìç";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            z-index: 2;
        }
        
        .location-map.target::before {
            content: "üéØ";
            color: #34a853;
        }
        
        .location-map.actual::before {
            content: "üìç";
            color: #ea4335;
        }
        
        .location-distance {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: 600;
            z-index: 3;
        }
        
        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: #777;
        }
        
        .no-data i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ccc;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #eaeaea;
            }
            
            .records-summary {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .records-table {
                display: block;
                overflow-x: auto;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .date-range {
                flex-direction: column;
            }
            
            .input-with-button {
                flex-direction: column;
            }
            
            .input-with-button .btn-input {
                width: 100%;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Êô∫ÊÖßÂÆùÊúçÂä°ËÆ∞ÂΩïÊü•ËØ¢</h1>
            <p>Êü•ËØ¢ÂíåÁÆ°ÁêÜÊâÄÊúâÊúçÂä°ËÆ∞ÂΩïÔºåÁîµËÑëÁ´ØBOSSÊàñÊä•Ë°®</p>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <h2 class="section-title">Êü•ËØ¢Êù°‰ª∂</h2>
                
                <div class="form-group">
                    <label for="gridArea">Âú∞ÂùÄ</label>
                    <div class="input-with-button">
                        <input type="text" id="gridArea" class="form-control" placeholder="ÁÇπÂáªÈÄâÊã©Âú∞ÂùÄ" readonly>
                        <button class="btn-input" onclick="showTreeModal('grid')">ÈÄâÊã©</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="department">Êìç‰ΩúÂëòÈÉ®Èó®</label>
                    <div class="input-with-button">
                        <input type="text" id="department" class="form-control" placeholder="ÁÇπÂáªÈÄâÊã©ÈÉ®Èó®" readonly>
                        <button class="btn-input" onclick="showTreeModal('department')">ÈÄâÊã©</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="operator">Êìç‰ΩúÂëò</label>
                    <div class="input-with-button">
                        <input type="text" id="operator" class="form-control" placeholder="ÁÇπÂáªÈÄâÊã©Êìç‰ΩúÂëò" readonly>
                        <button class="btn-input" onclick="showTreeModal('operator')">ÈÄâÊã©</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="serviceType">ÊúçÂä°Á±ªÂûã</label>
                    <select id="serviceType" class="form-control">
                        <option value="">ÂÖ®ÈÉ®ÊúçÂä°Á±ªÂûã</option>
                        <option value="installation">ËÆæÂ§áÂÆâË£Ö</option>
                        <option value="maintenance">ËÆæÂ§áÁª¥Êä§</option>
                        <option value="repair">ÊïÖÈöúÁª¥‰øÆ</option>
                        <option value="inspection">ÂÆöÊúüÊ£ÄÊü•</option>
                        <option value="training">‰ΩøÁî®ÂüπËÆ≠</option>
                        <option value="consultation">ÊäÄÊúØÂí®ËØ¢</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="dateRange">ÊúçÂä°Êó∂Èó¥ÊÆµ</label>
                    <div class="date-range">
                        <input type="date" id="startDate" class="form-control" value="2025-12-01">
                        <span>Ëá≥</span>
                        <input type="date" id="endDate" class="form-control" value="2025-12-18">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="abnormalFilter">ÂºÇÂ∏∏Á≠õÈÄâ</label>
                    <select id="abnormalFilter" class="form-control">
                        <option value="all">ÂÖ®ÈÉ®ËÆ∞ÂΩï</option>
                        <option value="duration">‰ªÖÊòæÁ§∫Êó∂ÈïøÂºÇÂ∏∏</option>
                        <option value="location">‰ªÖÊòæÁ§∫ÂÆö‰ΩçÂºÇÂ∏∏</option>
                        <option value="both">‰ªÖÊòæÁ§∫ÂèåÈáçÂºÇÂ∏∏</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary btn-block" onclick="searchRecords()">Êü•ËØ¢ËÆ∞ÂΩï</button>
                    <button class="btn btn-secondary btn-block" onclick="resetForm()">ÈáçÁΩÆÊù°‰ª∂</button>
                </div>
            </div>
            
            <div class="content">
                <h2 class="section-title">Êü•ËØ¢ÁªìÊûú</h2>
                
                <div class="records-summary" id="recordsSummary">
                    <!-- ÁªüËÆ°‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
                
                <div class="table-container">
                    <table class="records-table" id="recordsTable">
                        <thead>
                            <tr>
                                <th>ËÆ∞ÂΩïID</th>
                                <th>ÂÆ¢Êà∑ÂßìÂêç</th>
                                <th>Êìç‰ΩúÂëò</th>
                                <th>ÊúçÂä°Á±ªÂûã</th>
                                <th>ÊúçÂä°Êó∂Èïø</th>
                                <th>ÂÆö‰ΩçÁä∂ÊÄÅ</th>
                                <th>ÂºÄÂßãÊó∂Èó¥</th>
                                <th>Áä∂ÊÄÅ</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody id="recordsBody">
                            <!-- ËÆ∞ÂΩïÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                        </tbody>
                    </table>
                </div>
                
                <div class="no-data" id="noDataMessage">
                    <div>üìä</div>
                    <h3>ÊöÇÊó†ËÆ∞ÂΩï</h3>
                    <p>ËØ∑ËÆæÁΩÆÊü•ËØ¢Êù°‰ª∂Âπ∂ÁÇπÂáª"Êü•ËØ¢ËÆ∞ÂΩï"ÊåâÈíÆÊü•ÁúãÁªìÊûú</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
    <div class="detail-modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ËÆ∞ÂΩïËØ¶ÊÉÖ</h2>
                <button class="close-btn" onclick="closeModal('detailModal')">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- ËØ¶ÊÉÖÂÜÖÂÆπÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
    </div>
    
    <!-- ÂÖ®Â±èÁÖßÁâáÊü•ÁúãÊ®°ÊÄÅÊ°Ü -->
    <div class="fullscreen-photo-modal" id="fullscreenPhotoModal">
        <button class="fullscreen-close-btn" onclick="closeFullscreenPhoto()">&times;</button>
        <div class="fullscreen-photo-container" id="fullscreenPhotoContainer">
            <!-- ÂÖ®Â±èÁÖßÁâáÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
        </div>
        <div class="photo-info-overlay" id="photoInfoOverlay">
            <!-- ÁÖßÁâá‰ø°ÊÅØÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
        </div>
    </div>
    
    <!-- Ê†ëÂΩ¢ÈÄâÊã©Ê®°ÊÄÅÊ°Ü -->
    <div class="tree-modal" id="treeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="treeModalTitle">ÈÄâÊã©</h2>
                <button class="close-btn" onclick="closeModal('treeModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tree-search">
                    <input type="text" id="treeSearch" placeholder="ÊêúÁ¥¢..." onkeyup="filterTree()">
                </div>
                <div class="tree-container">
                    <ul class="tree-list" id="treeList">
                        <!-- Ê†ëÂΩ¢ÁªìÊûÑÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </ul>
                </div>
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn btn-secondary" onclick="closeModal('treeModal')">ÂèñÊ∂à</button>
                    <button class="btn btn-primary" onclick="confirmTreeSelection()" style="margin-left: 10px;">Á°ÆÂÆö</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ê®°ÊãüÊï∞ÊçÆ - Â¢ûÂä†ÂÆö‰ΩçÂºÇÂ∏∏‰ø°ÊÅØ
        const mockRecords = [
            {
                id: "REC001",
                customerName: "ÊùéÂõõ",
                customerCode: "211000150123",
                phone: "13800138000",
                address: "Â§©Ê¥•Â∏ÇÂçóÂºÄÂå∫ÊüêÊüêÂ∞èÂå∫12Âè∑Ê•º3ÂçïÂÖÉ501",
                targetLocation: "116.404, 39.915", // ÁõÆÊ†á‰ΩçÁΩÆ
                actualLocation: "116.404, 39.915", // ÂÆûÈôÖ‰ΩçÁΩÆ
                distance: 0, // Ë∑ùÁ¶ªÂ∑ÆÔºàÁ±≥Ôºâ
                grid: "ÁΩëÊ†º‰∏ÄÔºàÂçóÂºÄÂå∫Ôºâ",
                operator: "Âº†‰∏â",
                operatorId: "520111xlx",
                department: "ÂíåÂπ≥Ê≤≥Ë•øÂàÜÂÖ¨Âè∏",
                serviceType: "ËÆæÂ§áÂÆâË£Ö",
                startTime: "2023-10-15 09:30:25",
                endTime: "2023-10-15 11:15:10",
                duration: 104, // ÂàÜÈíü
                durationText: "1Â∞èÊó∂44ÂàÜÈíü",
                photos: 3,
                locationStatus: "Ê≠£Â∏∏",
                status: "completed",
                balance: "¬•120.00",
                socialCategory: "ÊôÆÈÄöÂÆ¢Êà∑",
                abnormal: false,
                locationAbnormal: false,
                abnormalReason: "",
                locationAbnormalReason: ""
            },
            {
                id: "REC002",
                customerName: "ÁéãÊòé",
                customerCode: "211000150124",
                phone: "13900139000",
                address: "Â§©Ê¥•Â∏ÇÊ≤≥Ë•øÂå∫ÊüêÊüêËä±Âõ≠8Âè∑Ê•º2ÂçïÂÖÉ302",
                targetLocation: "117.204, 39.125",
                actualLocation: "117.215, 39.135",
                distance: 1200, // 1.2ÂÖ¨Èáå
                grid: "ÁΩëÊ†º‰∫åÔºàÊ≤≥Ë•øÂå∫Ôºâ",
                operator: "ÊùéÂõõ",
                operatorId: "520112wl",
                department: "ÂüéË•øÂàÜÂÖ¨Âè∏",
                serviceType: "ÊïÖÈöúÁª¥‰øÆ",
                startTime: "2023-10-16 14:20:15",
                endTime: "2023-10-16 16:05:30",
                duration: 105, // ÂàÜÈíü
                durationText: "1Â∞èÊó∂45ÂàÜÈíü",
                photos: 2,
                locationStatus: "ÂÅèÂ∑Æ",
                status: "completed",
                balance: "¬•85.50",
                socialCategory: "VIPÂÆ¢Êà∑",
                abnormal: true,
                locationAbnormal: true,
                abnormalReason: "ÊúçÂä°Êó∂ÈïøÂºÇÂ∏∏",
                locationAbnormalReason: "ÂÆö‰ΩçÂÅèÂ∑Æ1.2ÂÖ¨Èáå"
            },
            {
                id: "REC003",
                customerName: "Âº†Á∫¢",
                customerCode: "211000150125",
                phone: "13600136000",
                address: "Â§©Ê¥•Â∏ÇÂíåÂπ≥Âå∫ÊüêÊüêÂ§ßÂé¶15Ê•º1503ÂÆ§",
                targetLocation: "117.204, 39.115",
                actualLocation: "117.204, 39.115",
                distance: 0,
                grid: "ÁΩëÊ†º‰∏âÔºàÂíåÂπ≥Âå∫Ôºâ",
                operator: "Áéã‰∫î",
                operatorId: "520113zm",
                department: "Êª®Êµ∑ÂàÜÂÖ¨Âè∏",
                serviceType: "‰ΩøÁî®ÂüπËÆ≠",
                startTime: "2023-10-17 10:10:00",
                endTime: "2023-10-17 11:30:00",
                duration: 80, // ÂàÜÈíü
                durationText: "1Â∞èÊó∂20ÂàÜÈíü",
                photos: 4,
                locationStatus: "Ê≠£Â∏∏",
                status: "completed",
                balance: "¬•200.00",
                socialCategory: "‰ºÅ‰∏öÂÆ¢Êà∑",
                abnormal: false,
                locationAbnormal: false,
                abnormalReason: "",
                locationAbnormalReason: ""
            },
            {
                id: "REC004",
                customerName: "ËµµÂàö",
                customerCode: "211000150126",
                phone: "13700137000",
                address: "Â§©Ê¥•Â∏ÇÊ≤≥‰∏úÂå∫ÊüêÊüêÂ∞èÂå∫5Âè∑Ê•º1ÂçïÂÖÉ101",
                targetLocation: "117.254, 39.135",
                actualLocation: "117.280, 39.150",
                distance: 2800, // 2.8ÂÖ¨Èáå
                grid: "ÁΩëÊ†ºÂõõÔºàÊ≤≥‰∏úÂå∫Ôºâ",
                operator: "ËµµÂÖ≠",
                operatorId: "520114lp",
                department: "ÂÆÅÊ≤≥ÂàÜÂÖ¨Âè∏",
                serviceType: "ËÆæÂ§áÂÆâË£Ö",
                startTime: "2023-10-18 13:45:20",
                endTime: "2023-10-18 16:20:10",
                duration: 155, // ÂàÜÈíü
                durationText: "2Â∞èÊó∂35ÂàÜÈíü",
                photos: 5,
                locationStatus: "ÂÅèÂ∑Æ",
                status: "completed",
                balance: "¬•320.00",
                socialCategory: "ÊôÆÈÄöÂÆ¢Êà∑",
                abnormal: true,
                locationAbnormal: true,
                abnormalReason: "ÊúçÂä°Êó∂ÈïøË∂ÖËøáÊ†áÂáÜ",
                locationAbnormalReason: "ÂÆö‰ΩçÂÅèÂ∑Æ2.8ÂÖ¨Èáå"
            },
            {
                id: "REC005",
                customerName: "ÂàòËä≥",
                customerCode: "211000150127",
                phone: "13500135000",
                address: "Â§©Ê¥•Â∏ÇÊ≤≥ÂåóÂå∫ÊüêÊüêÂÆ∂Âõ≠3Âè∑Ê•º4ÂçïÂÖÉ202",
                targetLocation: "117.204, 39.155",
                actualLocation: "117.204, 39.155",
                distance: 0,
                grid: "ÁΩëÊ†º‰∫îÔºàÊ≤≥ÂåóÂå∫Ôºâ",
                operator: "Âº†‰∏â",
                operatorId: "520111xlx",
                department: "ÂíåÂπ≥Ê≤≥Ë•øÂàÜÂÖ¨Âè∏",
                serviceType: "ËÆæÂ§áÁª¥Êä§",
                startTime: "2023-10-19 09:15:00",
                endTime: "2023-10-19 10:45:00",
                duration: 90, // ÂàÜÈíü
                durationText: "1Â∞èÊó∂30ÂàÜÈíü",
                photos: 2,
                locationStatus: "Ê≠£Â∏∏",
                status: "completed",
                balance: "¬•150.00",
                socialCategory: "ËÄÅÂπ¥ÂÆ¢Êà∑",
                abnormal: false,
                locationAbnormal: false,
                abnormalReason: "",
                locationAbnormalReason: ""
            },
            {
                id: "REC006",
                customerName: "Èôà‰ºü",
                customerCode: "211000150128",
                phone: "13400134000",
                address: "Â§©Ê¥•Â∏ÇÂçóÂºÄÂå∫ÊüêÊüêÂ∞èÂå∫10Âè∑Ê•º2ÂçïÂÖÉ601",
                targetLocation: "116.404, 39.915",
                actualLocation: "116.410, 39.920",
                distance: 800, // 0.8ÂÖ¨Èáå
                grid: "ÁΩëÊ†º‰∏ÄÔºàÂçóÂºÄÂå∫Ôºâ",
                operator: "ÊùéÂõõ",
                operatorId: "520112wl",
                department: "ÂüéË•øÂàÜÂÖ¨Âè∏",
                serviceType: "ÂÆöÊúüÊ£ÄÊü•",
                startTime: "2023-10-20 14:30:00",
                endTime: "2023-10-20 15:45:00",
                duration: 75, // ÂàÜÈíü
                durationText: "1Â∞èÊó∂15ÂàÜÈíü",
                photos: 3,
                locationStatus: "ÂÅèÂ∑Æ",
                status: "in-progress",
                balance: "¬•90.00",
                socialCategory: "ÊôÆÈÄöÂÆ¢Êà∑",
                abnormal: true,
                locationAbnormal: false,
                abnormalReason: "ÊúçÂä°Êú™ÂÆåÊàê",
                locationAbnormalReason: ""
            },
            {
                id: "REC007",
                customerName: "Êù®Ê¥ã",
                customerCode: "211000150129",
                phone: "13300133000",
                address: "Â§©Ê¥•Â∏ÇÊ≤≥Ë•øÂå∫ÊüêÊüêÂõΩÈôÖÂ§ßÂé¶22Ê•º2208",
                targetLocation: "117.204, 39.125",
                actualLocation: "117.300, 39.200",
                distance: 12500, // 12.5ÂÖ¨Èáå
                grid: "ÁΩëÊ†º‰∫åÔºàÊ≤≥Ë•øÂå∫Ôºâ",
                operator: "Áéã‰∫î",
                operatorId: "520113zm",
                department: "Êª®Êµ∑ÂàÜÂÖ¨Âè∏",
                serviceType: "ÊäÄÊúØÂí®ËØ¢",
                startTime: "2023-10-21 11:00:00",
                endTime: "2023-10-21 12:20:00",
                duration: 80, // ÂàÜÈíü
                durationText: "1Â∞èÊó∂20ÂàÜÈíü",
                photos: 1,
                locationStatus: "ÂÅèÂ∑Æ",
                status: "cancelled",
                balance: "¬•0.00",
                socialCategory: "‰ºÅ‰∏öÂÆ¢Êà∑",
                abnormal: false,
                locationAbnormal: true,
                abnormalReason: "",
                locationAbnormalReason: "ÂÆö‰ΩçÂÅèÂ∑Æ12.5ÂÖ¨ÈáåÔºåÂèØËÉΩÊú™Âà∞ËææÁé∞Âú∫"
            },
            {
                id: "REC008",
                customerName: "Âë®Ê∂õ",
                customerCode: "211000150130",
                phone: "13200132000",
                address: "Â§©Ê¥•Â∏ÇÂíåÂπ≥Âå∫ÊüêÊüêÂÖ¨ÂØìBÂ∫ß903",
                targetLocation: "117.204, 39.115",
                actualLocation: "117.204, 39.115",
                distance: 0,
                grid: "ÁΩëÊ†º‰∏âÔºàÂíåÂπ≥Âå∫Ôºâ",
                operator: "ËµµÂÖ≠",
                operatorId: "520114lp",
                department: "ÂÆÅÊ≤≥ÂàÜÂÖ¨Âè∏",
                serviceType: "ËÆæÂ§áÂÆâË£Ö",
                startTime: "2023-10-22 09:45:00",
                endTime: "2023-10-22 12:30:00",
                duration: 165, // ÂàÜÈíü
                durationText: "2Â∞èÊó∂45ÂàÜÈíü",
                photos: 6,
                locationStatus: "Ê≠£Â∏∏",
                status: "completed",
                balance: "¬•280.00",
                socialCategory: "VIPÂÆ¢Êà∑",
                abnormal: true,
                locationAbnormal: false,
                abnormalReason: "ÊúçÂä°Êó∂ÈïøÂºÇÂ∏∏ÔºåÁÖßÁâáÊï∞ÈáèÂºÇÂ∏∏",
                locationAbnormalReason: ""
            },
            {
                id: "REC009",
                customerName: "Âê¥Âçé",
                customerCode: "211000150131",
                phone: "13100131000",
                address: "Â§©Ê¥•Â∏ÇÊ≤≥‰∏úÂå∫ÊüêÊüêÂ∞èÂå∫7Âè∑Ê•º3ÂçïÂÖÉ402",
                targetLocation: "117.254, 39.135",
                actualLocation: "117.260, 39.140",
                distance: 700, // 0.7ÂÖ¨Èáå
                grid: "ÁΩëÊ†ºÂõõÔºàÊ≤≥‰∏úÂå∫Ôºâ",
                operator: "Âº†‰∏â",
                operatorId: "520111xlx",
                department: "ÂíåÂπ≥Ê≤≥Ë•øÂàÜÂÖ¨Âè∏",
                serviceType: "ËÆæÂ§áÁª¥Êä§",
                startTime: "2023-10-23 13:00:00",
                endTime: "2023-10-23 13:25:00",
                duration: 25, // ÂàÜÈíü
                durationText: "25ÂàÜÈíü",
                photos: 0,
                locationStatus: "ÂÅèÂ∑Æ",
                status: "completed",
                balance: "¬•75.00",
                socialCategory: "ÊôÆÈÄöÂÆ¢Êà∑",
                abnormal: true,
                locationAbnormal: false,
                abnormalReason: "ÊúçÂä°Êó∂ÈïøËøáÁü≠",
                locationAbnormalReason: ""
            },
            {
                id: "REC010",
                customerName: "ÈÉë‰∏Ω",
                customerCode: "211000150132",
                phone: "13000130000",
                address: "Â§©Ê¥•Â∏ÇÊ≤≥ÂåóÂå∫ÊüêÊüêËä±Âõ≠12Âè∑Ê•º1ÂçïÂÖÉ301",
                targetLocation: "117.204, 39.155",
                actualLocation: "117.250, 39.180",
                distance: 5600, // 5.6ÂÖ¨Èáå
                grid: "ÁΩëÊ†º‰∫îÔºàÊ≤≥ÂåóÂå∫Ôºâ",
                operator: "ÊùéÂõõ",
                operatorId: "520112wl",
                department: "ÂüéË•øÂàÜÂÖ¨Âè∏",
                serviceType: "ÊïÖÈöúÁª¥‰øÆ",
                startTime: "2023-10-24 15:30:00",
                endTime: "2023-10-24 18:45:00",
                duration: 195, // ÂàÜÈíü
                durationText: "3Â∞èÊó∂15ÂàÜÈíü",
                photos: 8,
                locationStatus: "ÂÅèÂ∑Æ",
                status: "completed",
                balance: "¬•450.00",
                socialCategory: "VIPÂÆ¢Êà∑",
                abnormal: true,
                locationAbnormal: true,
                abnormalReason: "ÊúçÂä°Êó∂ÈïøËøáÈïøÔºåÁÖßÁâáÊï∞ÈáèÂºÇÂ∏∏",
                locationAbnormalReason: "ÂÆö‰ΩçÂÅèÂ∑Æ5.6ÂÖ¨Èáå"
            }
        ];

        // Ê†ëÂΩ¢ÁªìÊûÑÊï∞ÊçÆ
        const treeData = {
            grid: {
                title: "ÈÄâÊã©Âú∞ÂùÄ",
                items: [
                    {
                        id: "grid1",
                        name: "ÁΩëÊ†º‰∏ÄÔºàÂçóÂºÄÂå∫Ôºâ",
                        children: [
                            { id: "grid1-1", name: "ÂçóÂºÄÂå∫ÂåóÈÉ®" },
                            { id: "grid1-2", name: "ÂçóÂºÄÂå∫‰∏≠ÈÉ®" },
                            { id: "grid1-3", name: "ÂçóÂºÄÂå∫ÂçóÈÉ®" }
                        ]
                    },
                    {
                        id: "grid2",
                        name: "ÁΩëÊ†º‰∫åÔºàÊ≤≥Ë•øÂå∫Ôºâ",
                        children: [
                            { id: "grid2-1", name: "Ê≤≥Ë•øÂå∫‰∏úÈÉ®" },
                            { id: "grid2-2", name: "Ê≤≥Ë•øÂå∫Ë•øÈÉ®" }
                        ]
                    },
                    {
                        id: "grid3",
                        name: "ÁΩëÊ†º‰∏âÔºàÂíåÂπ≥Âå∫Ôºâ",
                        children: [
                            { id: "grid3-1", name: "ÂíåÂπ≥Âå∫ÂåóÈÉ®" },
                            { id: "grid3-2", name: "ÂíåÂπ≥Âå∫ÂçóÈÉ®" }
                        ]
                    },
                    {
                        id: "grid4",
                        name: "ÁΩëÊ†ºÂõõÔºàÊ≤≥‰∏úÂå∫Ôºâ",
                        children: [
                            { id: "grid4-1", name: "Ê≤≥‰∏úÂå∫‰∏úÈÉ®" },
                            { id: "grid4-2", name: "Ê≤≥‰∏úÂå∫Ë•øÈÉ®" }
                        ]
                    },
                    {
                        id: "grid5",
                        name: "ÁΩëÊ†º‰∫îÔºàÊ≤≥ÂåóÂå∫Ôºâ",
                        children: [
                            { id: "grid5-1", name: "Ê≤≥ÂåóÂå∫ÂåóÈÉ®" },
                            { id: "grid5-2", name: "Ê≤≥ÂåóÂå∫ÂçóÈÉ®" }
                        ]
                    }
                ]
            },
            department: {
                title: "ÈÄâÊã©ÈÉ®Èó®",
                items: [
                    {
                        id: "dept1",
                        name: "ÂíåÂπ≥Ê≤≥Ë•øÂàÜÂÖ¨Âè∏",
                        children: [
                            { id: "dept1-1", name: "ÁΩëÁªúÊäÄÊúØÁªÑ" },
                            { id: "dept1-2", name: "ËΩØ‰ª∂ÊäÄÊúØÁªÑ" },
                            { id: "dept1-3", name: "Á°¨‰ª∂ÊäÄÊúØÁªÑ" }
                        ]
                    },
                    {
                        id: "dept2",
                        name: "Êª®Êµ∑ÂàÜÂÖ¨Âè∏",
                        children: [
                            { id: "dept2-1", name: "ÂÆ¢Êà∑Âí®ËØ¢ÁªÑ" },
                            { id: "dept2-2", name: "ÂÆ¢Êà∑ÊîØÊåÅÁªÑ" },
                            { id: "dept2-3", name: "ÂÆ¢Êà∑ÂõûËÆøÁªÑ" }
                        ]
                    },
                    {
                        id: "dept3",
                        name: "ÂüéË•øÂàÜÂÖ¨Âè∏",
                        children: [
                            { id: "dept3-1", name: "ËÆæÂ§áÁª¥‰øÆÁªÑ" },
                            { id: "dept3-2", name: "Áé∞Âú∫Áª¥‰øÆÁªÑ" }
                        ]
                    },
                    {
                        id: "dept4",
                        name: "ÂÆÅÊ≤≥ÂàÜÂÖ¨Âè∏",
                        children: [
                            { id: "dept4-1", name: "ËÆæÂ§áÂÆâË£ÖÁªÑ" },
                            { id: "dept4-2", name: "Á≥ªÁªüÂÆâË£ÖÁªÑ" }
                        ]
                    }
                ]
            },
            operator: {
                title: "ÈÄâÊã©Êìç‰ΩúÂëò",
                items: [
                    {
                        id: "op1",
                        name: "Âº†‰∏â (520111xlx)",
                        children: [
                            { id: "op1-1", name: "Ë¥üË¥£Âå∫ÂüüÔºöÂçóÂºÄÂå∫" },
                            { id: "op1-2", name: "ÊìÖÈïøÔºöËÆæÂ§áÂÆâË£Ö„ÄÅÁª¥Êä§" }
                        ]
                    },
                    {
                        id: "op2",
                        name: "ÊùéÂõõ (520112wl)",
                        children: [
                            { id: "op2-1", name: "Ë¥üË¥£Âå∫ÂüüÔºöÊ≤≥Ë•øÂå∫" },
                            { id: "op2-2", name: "ÊìÖÈïøÔºöÊïÖÈöúÁª¥‰øÆ" }
                        ]
                    },
                    {
                        id: "op3",
                        name: "Áéã‰∫î (520113zm)",
                        children: [
                            { id: "op3-1", name: "Ë¥üË¥£Âå∫ÂüüÔºöÂíåÂπ≥Âå∫" },
                            { id: "op3-2", name: "ÊìÖÈïøÔºö‰ΩøÁî®ÂüπËÆ≠„ÄÅÂí®ËØ¢" }
                        ]
                    },
                    {
                        id: "op4",
                        name: "ËµµÂÖ≠ (520114lp)",
                        children: [
                            { id: "op4-1", name: "Ë¥üË¥£Âå∫ÂüüÔºöÊ≤≥‰∏úÂå∫„ÄÅÊ≤≥ÂåóÂå∫" },
                            { id: "op4-2", name: "ÊìÖÈïøÔºöËÆæÂ§áÂÆâË£Ö„ÄÅÂÆöÊúüÊ£ÄÊü•" }
                        ]
                    }
                ]
            }
        };

        // ÂÖ®Â±ÄÂèòÈáè
        let currentAbnormalFilter = 'all';
        let currentTreeType = '';
        let selectedTreeItem = null;

        // È°µÈù¢Âä†ËΩΩÊó∂ÊòæÁ§∫ÊâÄÊúâËÆ∞ÂΩï
        document.addEventListener('DOMContentLoaded', function() {
            displayRecords(mockRecords);
        });

        // ÊòæÁ§∫Ê†ëÂΩ¢ÈÄâÊã©Ê®°ÊÄÅÊ°Ü
        function showTreeModal(type) {
            currentTreeType = type;
            selectedTreeItem = null;
            
            // ËÆæÁΩÆÊ®°ÊÄÅÊ°ÜÊ†áÈ¢ò
            document.getElementById('treeModalTitle').textContent = treeData[type].title;
            
            // Ê∏ÖÁ©∫ÊêúÁ¥¢Ê°Ü
            document.getElementById('treeSearch').value = '';
            
            // ÁîüÊàêÊ†ëÂΩ¢ÁªìÊûÑ
            generateTree(treeData[type].items);
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            document.getElementById('treeModal').style.display = 'flex';
        }

        // ÁîüÊàêÊ†ëÂΩ¢ÁªìÊûÑ
        function generateTree(items, parentElement = null) {
            const treeList = parentElement || document.getElementById('treeList');
            treeList.innerHTML = '';
            
            items.forEach(item => {
                const li = document.createElement('li');
                li.className = 'tree-item';
                li.dataset.id = item.id;
                li.dataset.name = item.name;
                
                let html = '';
                if (item.children && item.children.length > 0) {
                    html = `
                        <div>
                            <span class="toggle" onclick="toggleTreeItem(this)">+</span>
                            <span class="icon">üìÅ</span>
                            <span class="name">${item.name}</span>
                        </div>
                        <ul style="display: none;">
                    `;
                    
                    // ÈÄíÂΩíÁîüÊàêÂ≠êËäÇÁÇπ
                    const childUl = document.createElement('ul');
                    childUl.style.display = 'none';
                    li.appendChild(childUl);
                    
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                    li.onclick = function(e) {
                        if (e.target.classList.contains('toggle')) return;
                        selectTreeItem(this);
                    };
                    
                    // ÂÖàÊ∑ªÂä†Âü∫Á°ÄHTML
                    li.innerHTML = html;
                    
                    // ÈÄíÂΩíÂ§ÑÁêÜÂ≠êËäÇÁÇπ
                    generateTree(item.children, childUl);
                } else {
                    html = `
                        <div>
                            <span class="toggle"></span>
                            <span class="icon">üìÑ</span>
                            <span class="name">${item.name}</span>
                        </div>
                    `;
                    li.innerHTML = html;
                    
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                    li.onclick = function() {
                        selectTreeItem(this);
                    };
                }
                
                treeList.appendChild(li);
            });
        }

        // ÂàáÊç¢Ê†ëÂΩ¢ËäÇÁÇπÂ±ïÂºÄ/ÊäòÂè†
        function toggleTreeItem(toggleElement) {
            const parentLi = toggleElement.closest('li');
            const childUl = parentLi.querySelector('ul');
            
            if (childUl) {
                if (childUl.style.display === 'none') {
                    childUl.style.display = 'block';
                    toggleElement.textContent = '-';
                } else {
                    childUl.style.display = 'none';
                    toggleElement.textContent = '+';
                }
            }
        }

        // ÈÄâÊã©Ê†ëÂΩ¢ËäÇÁÇπ
        function selectTreeItem(itemElement) {
            // ÁßªÈô§‰πãÂâçÁöÑÈÄâÊã©
            document.querySelectorAll('.tree-item.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Ê∑ªÂä†ÂΩìÂâçÈÄâÊã©
            itemElement.classList.add('selected');
            selectedTreeItem = {
                id: itemElement.dataset.id,
                name: itemElement.dataset.name
            };
        }

        // ËøáÊª§Ê†ëÂΩ¢ËäÇÁÇπ
        function filterTree() {
            const searchText = document.getElementById('treeSearch').value.toLowerCase();
            const treeItems = document.querySelectorAll('.tree-item');
            
            treeItems.forEach(item => {
                const name = item.dataset.name.toLowerCase();
                if (name.includes(searchText)) {
                    item.style.display = '';
                    
                    // Â±ïÂºÄÁà∂ËäÇÁÇπ
                    let parent = item.parentElement;
                    while (parent && parent.classList.contains('tree-list')) {
                        const parentLi = parent.closest('li');
                        if (parentLi) {
                            const toggle = parentLi.querySelector('.toggle');
                            if (toggle && toggle.textContent === '+') {
                                toggleTreeItem(toggle);
                            }
                        }
                        parent = parent.parentElement;
                    }
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Á°ÆËÆ§Ê†ëÂΩ¢ÈÄâÊã©
        function confirmTreeSelection() {
            if (selectedTreeItem) {
                // Ê†πÊçÆÂΩìÂâçÁ±ªÂûãËÆæÁΩÆÂØπÂ∫îÁöÑËæìÂÖ•Ê°Ü
                if (currentTreeType === 'grid') {
                    document.getElementById('gridArea').value = selectedTreeItem.name;
                } else if (currentTreeType === 'department') {
                    document.getElementById('department').value = selectedTreeItem.name;
                } else if (currentTreeType === 'operator') {
                    document.getElementById('operator').value = selectedTreeItem.name;
                }
                
                // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                closeModal('treeModal');
            } else {
                alert('ËØ∑ÂÖàÈÄâÊã©‰∏Ä‰∏™ÈÄâÈ°π');
            }
        }

        // ÊêúÁ¥¢ËÆ∞ÂΩï
        function searchRecords() {
            // Ëé∑ÂèñÊü•ËØ¢Êù°‰ª∂
            const gridArea = document.getElementById('gridArea').value;
            const department = document.getElementById('department').value;
            const operator = document.getElementById('operator').value;
            const serviceType = document.getElementById('serviceType').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            currentAbnormalFilter = document.getElementById('abnormalFilter').value;
            
            // Á≠õÈÄâËÆ∞ÂΩï
            let filteredRecords = mockRecords.filter(record => {
                // ÊåâÁΩëÊ†ºÁ≠õÈÄâ
                if (gridArea && record.grid !== gridArea) return false;
                
                // ÊåâÈÉ®Èó®Á≠õÈÄâ
                if (department && record.department !== department) return false;
                
                // ÊåâÊìç‰ΩúÂëòÁ≠õÈÄâ
                if (operator && record.operator !== operator.split(' ')[0]) return false;
                
                // ÊåâÊúçÂä°Á±ªÂûãÁ≠õÈÄâ
                if (serviceType && record.serviceType !== getServiceTypeText(serviceType)) return false;
                
                // ÊåâÊó∂Èó¥ÊÆµÁ≠õÈÄâ
                const recordDate = record.startTime.split(' ')[0];
                if (startDate && recordDate < startDate) return false;
                if (endDate && recordDate > endDate) return false;
                
                // ÊåâÂºÇÂ∏∏Á±ªÂûãÁ≠õÈÄâ
                if (currentAbnormalFilter === 'duration' && !record.abnormal) return false;
                if (currentAbnormalFilter === 'location' && !record.locationAbnormal) return false;
                if (currentAbnormalFilter === 'both' && !(record.abnormal && record.locationAbnormal)) return false;
                
                return true;
            });
            
            // ÊòæÁ§∫Á≠õÈÄâÁªìÊûú
            displayRecords(filteredRecords);
        }

        // Ëé∑ÂèñÊúçÂä°Á±ªÂûãÊñáÊú¨
        function getServiceTypeText(value) {
            const typeMap = {
                'installation': 'ËÆæÂ§áÂÆâË£Ö',
                'maintenance': 'ËÆæÂ§áÁª¥Êä§',
                'repair': 'ÊïÖÈöúÁª¥‰øÆ',
                'inspection': 'ÂÆöÊúüÊ£ÄÊü•',
                'training': '‰ΩøÁî®ÂüπËÆ≠',
                'consultation': 'ÊäÄÊúØÂí®ËØ¢'
            };
            return typeMap[value] || '';
        }

        // Ëé∑ÂèñÂÆö‰ΩçÁä∂ÊÄÅÊ†áÁ≠æ - ‰øÆÊîπ‰∏∫Âè™Êúâ2ÁßçÁä∂ÊÄÅ
        function getLocationStatusTag(distance) {
            if (distance === 0) {
                return `<span class="location-status location-ok">Ê≠£Â∏∏</span>`;
            } else {
                return `<span class="location-status location-error">ÂÅèÂ∑Æ</span>`;
            }
        }

        // Ëé∑ÂèñËÆ∞ÂΩïË°åÁ±ªÂêç
        function getRecordRowClass(record) {
            if (record.abnormal && record.locationAbnormal) {
                return 'both-abnormal';
            } else if (record.locationAbnormal) {
                return 'location-abnormal';
            } else if (record.abnormal) {
                return 'abnormal';
            }
            return '';
        }

        // ÊòæÁ§∫ËÆ∞ÂΩï
        function displayRecords(records) {
            const recordsBody = document.getElementById('recordsBody');
            const noDataMessage = document.getElementById('noDataMessage');
            const recordsSummary = document.getElementById('recordsSummary');
            
            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            const totalRecords = records.length;
            const abnormalRecords = records.filter(r => r.abnormal).length;
            const locationAbnormalRecords = records.filter(r => r.locationAbnormal).length;
            const bothAbnormalRecords = records.filter(r => r.abnormal && r.locationAbnormal).length;
            const completedRecords = records.filter(r => r.status === 'completed').length;
            const averageDuration = totalRecords > 0 ? 
                Math.round(records.reduce((sum, r) => sum + r.duration, 0) / totalRecords) : 0;
            
            // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
            recordsSummary.innerHTML = `
                <div class="summary-card">
                    <div class="summary-title">ÊÄªËÆ∞ÂΩïÊï∞</div>
                    <div class="summary-value">${totalRecords}</div>
                </div>
                <div class="summary-card warning">
                    <div class="summary-title">Êó∂ÈïøÂºÇÂ∏∏</div>
                    <div class="summary-value">${abnormalRecords}</div>
                </div>
                <div class="summary-card location">
                    <div class="summary-title">ÂÆö‰ΩçÂºÇÂ∏∏</div>
                    <div class="summary-value">${locationAbnormalRecords}</div>
                </div>
                <div class="summary-card danger">
                    <div class="summary-title">ÂèåÈáçÂºÇÂ∏∏</div>
                    <div class="summary-value">${bothAbnormalRecords}</div>
                </div>
            `;
            
            // Â¶ÇÊûúÊ≤°ÊúâËÆ∞ÂΩïÔºåÊòæÁ§∫Êó†Êï∞ÊçÆÊ∂àÊÅØ
            if (records.length === 0) {
                recordsBody.innerHTML = '';
                noDataMessage.style.display = 'block';
                return;
            }
            
            // ÈöêËóèÊó†Êï∞ÊçÆÊ∂àÊÅØ
            noDataMessage.style.display = 'none';
            
            // ÁîüÊàêËÆ∞ÂΩïË°®Ê†ºË°å
            let rowsHTML = '';
            records.forEach(record => {
                let statusBadge = '';
                if (record.status === 'completed') {
                    statusBadge = '<span class="status-badge status-completed">Â∑≤ÂÆåÊàê</span>';
                } else if (record.status === 'in-progress') {
                    statusBadge = '<span class="status-badge status-in-progress">ËøõË°å‰∏≠</span>';
                } else if (record.status === 'cancelled') {
                    statusBadge = '<span class="status-badge status-cancelled">Â∑≤ÂèñÊ∂à</span>';
                }
                
                // Âà§Êñ≠ÊúçÂä°Êó∂ÈïøÁ±ªÂà´
                let durationClass = 'duration-normal';
                if (record.duration < 30) {
                    durationClass = 'duration-short';
                } else if (record.duration > 150) {
                    durationClass = 'duration-long';
                }
                
                // ÂºÇÂ∏∏ÂéüÁÇπÊ†áËØÜ - ‰ΩøÁî®‰∏çÂêåÈ¢úËâ≤ÁöÑÂéüÁÇπ
                const durationDot = record.abnormal ? 
                    `<span class="abnormal-dot duration-abnormal-dot" title="Êó∂ÈïøÂºÇÂ∏∏"></span>` : '';
                
                const locationDot = record.locationAbnormal ? 
                    `<span class="abnormal-dot location-abnormal-dot" title="ÂÆö‰ΩçÂºÇÂ∏∏"></span>` : '';
                
                // Ëé∑ÂèñÂÆö‰ΩçÁä∂ÊÄÅÊ†áÁ≠æ
                const locationStatusTag = getLocationStatusTag(record.distance);
                
                rowsHTML += `
                    <tr class="${getRecordRowClass(record)}">
                        <td>
                            <div class="record-id-container">
                                ${durationDot}
                                ${locationDot}
                                ${record.id}
                            </div>
                        </td>
                        <td>${record.customerName}</td>
                        <td>${record.operator} (${record.operatorId})</td>
                        <td>${record.serviceType}</td>
                        <td class="duration-cell ${durationClass}">${record.durationText}</td>
                        <td>${locationStatusTag}</td>
                        <td>${record.startTime.split(' ')[0]}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-view" onclick="showDetail('${record.id}')">Êü•ÁúãËØ¶ÊÉÖ</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            recordsBody.innerHTML = rowsHTML;
        }

        // ÊòæÁ§∫ËØ¶ÊÉÖ
        function showDetail(recordId) {
            const record = mockRecords.find(r => r.id === recordId);
            if (!record) return;
            
            // Âà§Êñ≠ÊúçÂä°Êó∂ÈïøÁ±ªÂà´
            let durationClass = 'duration-normal';
            let durationNote = '';
            if (record.duration < 30) {
                durationClass = 'duration-short';
                durationNote = 'ÔºàÊúçÂä°Êó∂ÈïøËøáÁü≠Ôºâ';
            } else if (record.duration > 150) {
                durationClass = 'duration-long';
                durationNote = 'ÔºàÊúçÂä°Êó∂ÈïøËøáÈïøÔºâ';
            }
            
            // ÂºÇÂ∏∏‰ø°ÊÅØ
            const abnormalInfo = record.abnormal ? 
                `<div class="detail-item">
                    <div class="detail-label">Êó∂ÈïøÂºÇÂ∏∏ÂéüÂõ†</div>
                    <div class="detail-value" style="color: #ea4335;">${record.abnormalReason}</div>
                </div>` : '';
            
            // ÂÆö‰ΩçÂºÇÂ∏∏‰ø°ÊÅØ
            const locationAbnormalInfo = record.locationAbnormal ? 
                `<div class="detail-item">
                    <div class="detail-label">ÂÆö‰ΩçÂºÇÂ∏∏ÂéüÂõ†</div>
                    <div class="detail-value" style="color: #9c27b0;">${record.locationAbnormalReason}</div>
                </div>` : '';
            
            // ÂÆö‰ΩçÂèØËßÜÂåñ
            const locationMapHTML = `
                <div class="detail-section">
                    <h3>‰ΩçÁΩÆ‰ø°ÊÅØÂØπÊØî</h3>
                    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <div class="detail-label">ÁõÆÊ†á‰ΩçÁΩÆ</div>
                            <div class="detail-value">${record.targetLocation}</div>
                            <div class="location-map target">
                                <div class="location-distance">ÁõÆÊ†áÁÇπ</div>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div class="detail-label">ÂÆûÈôÖ‰ΩçÁΩÆ</div>
                            <div class="detail-value">${record.actualLocation}</div>
                            <div class="location-map actual">
                                <div class="location-distance">ÂÆûÈôÖÁÇπ</div>
                            </div>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">‰ΩçÁΩÆÂÅèÂ∑Æ</div>
                        <div class="detail-value ${record.distance > 0 ? 'location-error' : 'location-ok'}" style="font-weight: 600;">
                            ${record.distance > 0 ? `${record.distance}Á±≥ (${(record.distance/1000).toFixed(1)}ÂÖ¨Èáå)` : 'Êó†ÂÅèÂ∑Æ'}
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">ÂÆö‰ΩçÁä∂ÊÄÅ</div>
                        <div class="detail-value">${record.locationStatus}</div>
                    </div>
                </div>
            `;
            
            // ÁîüÊàêÁÖßÁâáÈ¢ÑËßàHTML
            let photosHTML = '';
            if (record.photos > 0) {
                // ÊòæÁ§∫ÊâÄÊúâÁÖßÁâáÁöÑÈ¢ÑËßà
                for (let i = 0; i < Math.min(record.photos, 8); i++) {
                    // ‰ΩøÁî®Ê®°ÊãüÁöÑÊú¨Âú∞ÂõæÁâáURL
                    // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáåÂ∫îËØ•‰ΩøÁî®ÁúüÂÆûÁöÑÊú¨Âú∞ÂõæÁâáË∑ØÂæÑ
                    const photoUrl = `https://picsum.photos/120/120?random=${recordId}${i}`;
                    photosHTML += `
                        <div class="photo-preview-item" onclick="showFullscreenPhoto('${recordId}', ${i})">
                            <img src="${photoUrl}" alt="Áé∞Âú∫ÁÖßÁâá ${i+1}">
                            <div class="photo-count">ÁÖßÁâá ${i+1}</div>
                        </div>
                    `;
                }
                
                // Â¶ÇÊûúÁÖßÁâáË∂ÖËøá8Âº†ÔºåÊòæÁ§∫Êõ¥Â§öÊèêÁ§∫
                if (record.photos > 8) {
                    photosHTML += `
                        <div class="photo-preview-item" style="display: flex; align-items: center; justify-content: center; background-color: #f0f0f0; cursor: default;">
                            <div style="text-align: center; color: #666;">
                                <div style="font-size: 24px; margin-bottom: 5px;">+${record.photos - 8}</div>
                                <div style="font-size: 12px;">Êõ¥Â§öÁÖßÁâá</div>
                            </div>
                        </div>
                    `;
                }
            } else {
                photosHTML = '<div style="color: #999; padding: 20px; text-align: center;">ÊöÇÊó†Áé∞Âú∫ÁÖßÁâá</div>';
            }
            
            // ÁîüÊàêËØ¶ÊÉÖHTML
            const detailHTML = `
                <div class="detail-section">
                    <h3>Âü∫Êú¨‰ø°ÊÅØ</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">ËÆ∞ÂΩïID</div>
                            <div class="detail-value">
                                ${record.id} 
                                ${record.abnormal ? '<span class="abnormal-tag">Êó∂ÈïøÂºÇÂ∏∏</span>' : ''}
                                ${record.locationAbnormal ? '<span class="location-abnormal-tag">ÂÆö‰ΩçÂºÇÂ∏∏</span>' : ''}
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ÂÆ¢Êà∑ÂßìÂêç</div>
                            <div class="detail-value">${record.customerName}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ÂÆ¢Êà∑ÁºñÁ†Å</div>
                            <div class="detail-value">${record.customerCode}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ËÅîÁ≥ªÁîµËØù</div>
                            <div class="detail-value">${record.phone}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ËÅîÁ≥ªÂú∞ÂùÄ</div>
                            <div class="detail-value">${record.address}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ÊâÄÂ±ûÁΩëÊ†º</div>
                            <div class="detail-value">${record.grid}</div>
                        </div>
                        ${abnormalInfo}
                        ${locationAbnormalInfo}
                    </div>
                </div>
                
                ${locationMapHTML}
                
                <div class="detail-section">
                    <h3>ÊúçÂä°‰ø°ÊÅØ</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Êìç‰ΩúÂëò</div>
                            <div class="detail-value">${record.operator} (${record.operatorId})</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ÊâÄÂ±ûÈÉ®Èó®</div>
                            <div class="detail-value">${record.department}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ÊúçÂä°Á±ªÂûã</div>
                            <div class="detail-value">${record.serviceType}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ÂºÄÂßãÊó∂Èó¥</div>
                            <div class="detail-value">${record.startTime}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ÁªìÊùüÊó∂Èó¥</div>
                            <div class="detail-value">${record.endTime}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ÊúçÂä°Êó∂Èïø</div>
                            <div class="detail-value ${durationClass}">${record.durationText} ${durationNote}</div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3>Áé∞Âú∫ÁÖßÁâá (${record.photos}Âº†)</h3>
                    <div class="photos-container">
                        ${photosHTML}
                    </div>
                    <p style="margin-top: 10px; color: #666; font-size: 14px;">ÁÇπÂáªÁÖßÁâáÂèØÂÖ®Â±èÊü•Áúã</p>
                </div>
            `;
            
            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            document.getElementById('modalBody').innerHTML = detailHTML;
            document.getElementById('detailModal').style.display = 'flex';
        }

        // ÊòæÁ§∫ÂÖ®Â±èÁÖßÁâá
        function showFullscreenPhoto(recordId, photoIndex) {
            const record = mockRecords.find(r => r.id === recordId);
            if (!record) return;
            
            // ‰ΩøÁî®Ê®°ÊãüÁöÑÊú¨Âú∞ÂõæÁâáURL
            // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáåÂ∫îËØ•‰ΩøÁî®ÁúüÂÆûÁöÑÊú¨Âú∞ÂõæÁâáË∑ØÂæÑ
            const photoUrl = `https://picsum.photos/1920/1080?random=${recordId}${photoIndex}`;
            
            // ËÆæÁΩÆÂÖ®Â±èÁÖßÁâá
            const photoContainer = document.getElementById('fullscreenPhotoContainer');
            photoContainer.innerHTML = `
                <img src="${photoUrl}" alt="Áé∞Âú∫ÁÖßÁâá ${photoIndex+1}" class="fullscreen-photo">
            `;
            
            // ËÆæÁΩÆÁÖßÁâá‰ø°ÊÅØ
            const photoInfo = document.getElementById('photoInfoOverlay');
            photoInfo.innerHTML = `
                <div>
                    <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">${record.customerName} - ${record.serviceType}</div>
                    <div style="font-size: 14px;">ËÆ∞ÂΩïID: ${record.id} | ÁÖßÁâá ${photoIndex+1} / ${record.photos} | ÊãçÊëÑÊó∂Èó¥: ${record.startTime}</div>
                </div>
            `;
            
            // ÊòæÁ§∫ÂÖ®Â±èÁÖßÁâáÊ®°ÊÄÅÊ°Ü
            document.getElementById('fullscreenPhotoModal').style.display = 'flex';
            
            // Á¶ÅÁî®È°µÈù¢ÊªöÂä®
            document.body.style.overflow = 'hidden';
        }

        // ÂÖ≥Èó≠ÂÖ®Â±èÁÖßÁâá
        function closeFullscreenPhoto() {
            document.getElementById('fullscreenPhotoModal').style.display = 'none';
            // ÊÅ¢Â§çÈ°µÈù¢ÊªöÂä®
            document.body.style.overflow = 'auto';
        }

        // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ÈáçÁΩÆË°®Âçï
        function resetForm() {
            document.getElementById('gridArea').value = '';
            document.getElementById('department').value = '';
            document.getElementById('operator').value = '';
            document.getElementById('serviceType').value = '';
            document.getElementById('startDate').value = '2023-10-01';
            document.getElementById('endDate').value = '2023-10-31';
            document.getElementById('abnormalFilter').value = 'all';
            
            // ÊòæÁ§∫ÊâÄÊúâËÆ∞ÂΩï
            displayRecords(mockRecords);
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜËÉåÊôØÂÖ≥Èó≠
        document.querySelectorAll('.detail-modal, .fullscreen-photo-modal, .tree-modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    if (this.id === 'fullscreenPhotoModal') {
                        closeFullscreenPhoto();
                    } else {
                        this.style.display = 'none';
                    }
                }
            });
        });

        // ESCÈîÆÂÖ≥Èó≠ÂÖ®Â±èÁÖßÁâá
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('fullscreenPhotoModal').style.display === 'flex') {
                closeFullscreenPhoto();
            }
        });
    </script>
</body>
</html>
